<script>
	import Codemirror from "./codemirror/Codemirror.html"
	import AnsiUp from "ansi_up"

	const ansiup = new AnsiUp()

	let text, stdout, stderr, result

	function sendText(){
		fetch('/python', {
            method: 'POST',
            headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json',
				'x-csrf-token': window.csrfToken
			},
            body: JSON.stringify({ command: text })
        })
        .then(resp => resp.json())
        .then(s => {
			stdout = s.stdout.replace(new RegExp('\n', 'g'), '')
			stderr = s.stderr
			result = s.result
		})
	}

	function on_change(cm){
		text = cm.getValue()
	}

</script>

<style>
	.stdout {
		font-family: mono;
	}
</style>

<div>
	<div>
		<Codemirror mode="python" on_change={on_change}></Codemirror>
		<div class="stdout">
			{@html stdout}
		</div>
	</div>
	<button on:click={sendText}>Send me</button>
</div>
